---
schemaVersion: "2.2"
description: "Servo Adjust Command"
parameters:
  UriEnableCache:
    type: "String"
    default: "{{ssm:/servo/ec2win/UriEnableCache}}"
  UriScavengerPeriod:
    type: "String"
    default: "{{ssm:/servo/ec2win/UriScavengerPeriod}}"
  WebConfigCacheEnabled:
    type: "String"
    default: "{{ssm:/servo/ec2win/WebConfigCacheEnabled}}"
  WebConfigEnableKernelCache:
    type: "String"
    default: "{{ssm:/servo/ec2win/WebConfigEnableKernelCache}}"
mainSteps:
- action: "aws:runPowerShellScript"
  name: "main"
  inputs:
    runCommand:
    - "Import-Module WebAdministration"
    - "Set-WebConfigurationProperty -Filter 'system.webServer/caching' -PSPath 'MACHINE/WEBROOT/APPHOST' -Name 'enabled' -Value {{ WebConfigCacheEnabled }}"
    - "Set-WebConfigurationProperty -Filter 'system.webServer/caching' -PSPath 'MACHINE/WEBROOT/APPHOST' -Name 'enableKernelCache' -Value {{ WebConfigEnableKernelCache }}"
    - "Set-ItemProperty -Path 'HKLM:\\System\\CurrentControlSet\\Services\\Http\\Parameters' -Name 'UriEnableCache' -Value {{ UriEnableCache }}"
    - "Set-ItemProperty -Path 'HKLM:\\System\\CurrentControlSet\\Services\\Http\\Parameters' -Name 'UriScavengerPeriod' -Value {{ UriScavengerPeriod }}"
